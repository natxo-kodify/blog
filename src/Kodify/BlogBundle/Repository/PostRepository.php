<?php

namespace Kodify\BlogBundle\Repository;

/**
 * PostRepository.
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class PostRepository extends AbstractBaseRepository
{
    public function highestRated($limit = null, $offset = 0)
    {
        $limit = $this->getLimit($limit);

        return $this->createQueryBuilder('p')
            ->select('p')
            ->addSelect('AVG(r.rating) AS HIDDEN avg_rating')
            ->leftJoin('p.ratings', 'r')
            ->addOrderBy('avg_rating', 'DESC')
            ->groupBy('p.id')
            ->setMaxResults($limit)
            ->setFirstResult($offset)
            ->getQuery()
            ->execute();
    }
}
