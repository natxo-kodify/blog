<?php

namespace Kodify\BlogBundle\Repository;

/**
 * PostRepository.
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class PostRepository extends AbstractBaseRepository
{
    public function highestRated()
    {
        $qb = $this->createQueryBuilder('p');

        return $qb
            ->select('p')
            ->addSelect('AVG(r.rating) AS HIDDEN avg_rating')
            ->leftJoin('p.ratings', 'r')
            ->addOrderBy('avg_rating', 'DESC')
            ->groupBy('p.id')
            ->getQuery()
            ->execute();
    }
}
